<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Details - TrackMe</title>
    <link rel="stylesheet" href="styles/admin-viewJob.css" />
    <link rel="stylesheet" href="styles/admin.css" />
</head>

<body>
    <!-- Header -->
    <header class="header">
        <section class="logo">
            <img src="assets/icons/plane_desktop.svg" alt="TrackMe Logo" />
            <span class="logo-text">TrackMe</span>
        </section>
        <nav class="main-nav">
            <a href="admin-dashboard.html" class="nav-item">
                <img src="assets/icons/home.svg" alt="Home" /> Home
            </a>
            <a href="jobs.html" class="nav-item">
                <img src="assets/icons/jobs.svg" alt="Jobs" /> Jobs
            </a>
            <a href="add-job.html" class="nav-item">
                <img src="assets/icons/add_job.svg" alt="Add Job" /> Add Job
            </a>
        </nav>
        <section class="user-info">
            <img src="assets/icons/user.svg" alt="User Icon" />
            <span>Hello, <strong>User!</strong></span>
        </section>
    </header>

    <!-- Main content -->
    <main class="job-view">

        <!-- Breadcrumb -->
        <section class="breadcrumb">
            <section class="breadcrumb__item">Jobs</section>
            <section class="breadcrumb__separator">â€º</section>
            <section class="breadcrumb__item breadcrumb__item--current">Job 0001</section>
        </section>

        <!-- Job Header -->
        <section class="job-header">
            <section class="job-header__left">
                <span class="job-header__label">Job ID</span>
                <span class="job-header__value">0001</span>
            </section>

            <section class="job-header__actions">
                <section class="action-group">
                    <section class="status-dropdown">
                        <button class="status-select" id="statusToggle">
                            <span id="statusLabel">Active</span>
                            <img src="assets/icons/chevron_down.svg" alt="â–¼" class="chevron-icon" />
                        </button>
                        <ul class="status-options" id="statusOptions">
                            <li data-value="active">Active</li>
                            <li data-value="on-hold">On Hold</li>
                            <li data-value="delivered">Delivered</li>
                        </ul>
                    </section>


                    <section class="action-button">
                        <img src="assets/icons/chat11.svg" alt="Chat" />
                        <span>Chat</span>
                    </section>
                </section>

                <section class="action-button" id="uploadButton">
                    <img src="assets/icons/upload.svg" alt="Upload" />
                    <span>Upload Files</span>
                </section>

                <section class="action-button">
                    <img src="assets/icons/edit.svg" alt="Edit" />
                    <span>Edit</span>
                </section>
                <section class="action-button action-button--danger">
                    <img src="assets/icons/delete.svg" alt="Delete" />
                    <span>Delete</span>
                </section>
            </section>

        </section>

        <!-- Courier Info -->
        <section class="courier-info">
            <img src="assets/icons/user1.svg" alt="Courier Icon" />
            <span class="courier-info__label">Courier</span>
            <span class="courier-info__name">Chen Rozenberg</span>
        </section>

        <!-- Status Progress -->
        <!-- ========== Status Card ========== -->
        <article class="card status-card">

            <section class="status-progress-bar">
                <section id="step-1" class="progress-step">
                    <section class="progress-icon">
                        <img src="assets/icons/step1.svg" alt="Step 1" />
                    </section>
                </section>
                <section id="line-1" class="progress-line"></section>
                <section id="step-2" class="progress-step">
                    <section class="progress-icon">
                        <img src="assets/icons/step2.svg" alt="Step 2" />
                    </section>
                </section>
                <section id="line-2" class="progress-line"></section>
                <section id="step-3" class="progress-step">
                    <section class="progress-icon">
                        <img src="assets/icons/location1.svg" alt="Step 3" />
                    </section>
                </section>
                <section id="line-3" class="progress-line"></section>
                <section id="step-4" class="progress-step">
                    <section class="progress-icon">
                        <img src="assets/icons/file1.svg" alt="Step 4" />
                    </section>
                </section>
            </section>

            <!-- ðŸ”µ Courier Status Display (Dynamic) -->
            <section class="status-display">
                <div class="status-label">Courier Status</div>
                <div class="courier-status" id="courierStatusText">Loading...</div>
            </section>

        </article>

        <!-- Job Details Card -->
        <section class="job-details-card">

            <!-- Pickup Info -->
            <section class="job-details job-details--pickup">
                <section class="job-details__section-title">PickUp Info</section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/home11.svg" alt="Address" class="icon-inline" />
                        Address
                    </span>
                    <span class="job-details__value">123 Herzl St, Tel Aviv</span>
                </section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/time11.svg" alt="Time" class="icon-inline" />
                        Time
                    </span>
                    <span class="job-details__value">3/4/24 1pm</span>
                </section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/user1.svg" alt="Contact Icon" class="icon-inline" />
                        Contact Person
                    </span>
                    <span class="job-details__value">Aliza Cohen</span>
                </section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/phone11.svg" alt="Phone" class="icon-inline" />
                        Phone
                    </span>
                    <span class="job-details__value">+972-522308787</span>
                </section>
            </section>

            <!-- Delivery Info -->
            <section class="job-details job-details--delivery">
                <section class="job-details__section-title">Delivery Info</section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/home11.svg" alt="Address" class="icon-inline" />
                        Address
                    </span>
                    <span class="job-details__value">Mount Sinai Hospital, New York</span>
                </section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/time11.svg" alt="Time" class="icon-inline" />
                        Time
                    </span>
                    <span class="job-details__value">4/4/24 1pm</span>
                </section>

                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/user1.svg" alt="Contact Icon" class="icon-inline" />
                        Contact Person
                    </span>
                    <span class="job-details__value">Aliza Cohen</span>
                </section>
                <section class="job-details__field">
                    <span class="job-details__label">
                        <img src="assets/icons/phone11.svg" alt="Phone" class="icon-inline" />
                        Phone
                    </span>
                    <span class="job-details__value">+1-956-667-8241</span>
                </section>
            </section>
        </section>

        <!-- Flight Info -->
        <section class="flight-details">
            <section class="flight-details__header">
                <img src="assets/icons/c44.svg" alt="Flight Icon" />
                <span class="flight-details__title">Fly Details</span>
            </section>

            <section class="flight-details__content">
                <section class="flight-details__entry">
                    <span class="flight-details__date">3/4/24</span>
                    <span class="flight-details__code">
                        <img src="assets/icons/c46.svg" alt="Plane" class="icon-inline" />
                        LY 0025
                    </span>
                </section>
                <section class="flight-details__entry">
                    <span class="flight-details__date">6/4/24</span>
                    <span class="flight-details__code">
                        <img src="assets/icons/c46.svg" alt="Plane" class="icon-inline" />
                        LY 0005
                    </span>
                </section>
            </section>
        </section>

    </main>
    <!-- Popup: Confirm Delete -->
    <section id="popup-confirm-delete" class="popup hidden">
        <section class="popup-content">
            <p>Are you sure you want to delete this job?</p>
            <section class="popup-actions">
                <button class="popup-btn confirm" data-action="delete">Delete</button>
                <button class="popup-btn cancel" data-action="cancel">Cancel</button>
            </section>
        </section>
    </section>

    <!-- Popup: Confirm Edit Save -->
<!-- Popup: Confirm Edit Save -->
<section id="popup-confirm-edit-save" class="popup hidden">
  <section class="popup-content">
    <p>Save changes to this job?</p>
    <section class="popup-actions">
      <button class="popup-btn confirm" data-action="save">Save</button>
      <button class="popup-btn cancel" data-action="cancel">Cancel</button>
    </section>
  </section>
</section>


    <!-- Popup: Confirm Status Change -->
    <section id="popup-confirm-status-change" class="popup hidden">
        <section class="popup-content">
            <p>Change job status?</p>
            <section class="popup-actions">
                <button class="popup-btn confirm" data-action="confirm-status">Confirm</button>
                <button class="popup-btn cancel" data-action="cancel">Cancel</button>
            </section>
        </section>
    </section>

    <!-- Popup: Upload Documents -->
    <section id="documentsModal" class="documents-modal hidden">
        <section class="documents-container">
            <h2 class="documents-title">Documents</h2>

            <ul class="document-list">
                <li class="document-item">
                    <span class="document-name">Courier Details Letter</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
                <li class="document-item">
                    <span class="document-name">Flight Ticket</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
                <li class="document-item">
                    <span class="document-name">TSA Clearance</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
                <li class="document-item">
                    <span class="document-name">Passport (US)</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
                <li class="document-item">
                    <span class="document-name">Hotel Voucher</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
                <li class="document-item">
                    <span class="document-name">Customs Clearance</span>
                    <label class="upload-icon">
                        <input type="file" required />
                        <img src="assets/icons/upload.svg" alt="Upload" />
                    </label>
                </li>
            </ul>

            <section class="popup-actions">
                <button class="popup-btn confirm" data-action="upload">Upload</button>
                <button class="popup-btn cancel" data-action="cancel">Cancel</button>
            </section>
        </section>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const courierStatus = "Package Picked Up";
            const statusElement = document.getElementById("courierStatusText");
            if (statusElement) statusElement.innerText = courierStatus;

            const steps = {
                "Order Created": 0,
                "Heading to Pickup": 1,
                "Package Picked Up": 2,
                "On the Way": 3,
                "Delivered": 4
            };

            const currentStep = steps[courierStatus] || 0;
            for (let i = 1; i <= currentStep; i++) {
                document.getElementById(`step-${i}`)?.classList.add("completed");
                if (i < currentStep) document.getElementById(`line-${i}`)?.classList.add("completed");
            }

            // ===== Status Dropdown Toggle =====
            const toggle = document.getElementById("statusToggle");
            const options = document.getElementById("statusOptions");
            const label = document.getElementById("statusLabel");

            toggle?.addEventListener("click", () => {
                options.style.display = options.style.display === "block" ? "none" : "block";
            });

            options?.querySelectorAll("li").forEach((option) => {
                option.addEventListener("click", () => {
                    const value = option.dataset.value;
                    showConfirmationPopup("Change job status?", () => {
                        label.textContent = option.textContent;
                        toggle.classList.remove("active", "on-hold", "delivered");
                        toggle.classList.add(value);
                        options.style.display = "none";
                        showToast(`Status changed to "${option.textContent}"`, "blue");
                    });
                });
            });

            document.addEventListener("click", (e) => {
                if (!toggle.contains(e.target) && !options.contains(e.target)) {
                    options.style.display = "none";
                }
            });

            // ===== Edit =====
            const editButton = document.querySelector(".action-button img[alt='Edit']")?.closest(".action-button");
            editButton?.addEventListener("click", () => {
                enableEditing();
            });

            // ===== Save Button (dynamically generated) =====
            const saveButton = document.getElementById("saveChanges");
            if (saveButton) {
                saveButton.addEventListener("click", () => {
                    showConfirmationPopup("Save changes to the job?", () => {
                        showToast("Changes saved successfully", "blue");
                    });
                });
            }

            // ===== Delete =====
            const deleteButton = document.querySelector(".action-button--danger");
            deleteButton.addEventListener("click", () => {
                showConfirmationPopup("Are you sure you want to delete this job?", () => {
                    showToast("Job deleted successfully", "red");
                }, "red");
            });

            // ===== Upload Files Button =====
            const uploadBtn = document.getElementById("uploadButton");
            const documentsModal = document.getElementById("documentsModal");
            uploadBtn?.addEventListener("click", () => {
                documentsModal?.classList.remove("hidden");
            });

            // ===== Close Modals =====
            document.querySelectorAll(".popup-cancel, .popup-close")?.forEach((el) =>
                el.addEventListener("click", () => {
                    document.querySelector(".popup-overlay")?.remove();
                })
            );

            // ===== Enable Edit Mode =====
            function enableEditing() {
                document.querySelectorAll(".job-details__value").forEach((el) => {
                    const text = el.textContent.trim();
                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = text;
                    input.className = "editable-field";
                    el.replaceWith(input);
                });

                document.querySelectorAll(".flight-details__date, .flight-details__code").forEach((el) => {
                    const text = el.textContent.trim();
                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = text;
                    input.className = "editable-field";
                    el.innerHTML = "";
                    el.appendChild(input);
                });

                if (!document.getElementById("saveChanges")) {
                    const saveBtn = document.createElement("section");
                    saveBtn.className = "action-button";
                    saveBtn.id = "saveChanges";
                    saveBtn.innerHTML = `<img src="assets/icons/save.svg" alt="Save" /><span>Save</span>`;
                    document.querySelector(".job-header__actions")?.appendChild(saveBtn);

                    saveBtn.addEventListener("click", () => {
                        showConfirmationPopup("Save changes to the job?", () => {
                            showToast("Changes saved successfully", "blue");
                        });
                    });
                }
            }


            // ===== Show Popup Confirm =====
            function showConfirmationPopup(message, onConfirm, color = "blue") {
                const overlay = document.createElement("section");
                overlay.className = "popup-overlay";
                overlay.innerHTML = `
      <section class="popup-dialog popup-${color}">
        <section class="popup-message">${message}</section>
        <section class="popup-actions">
          <button class="popup-confirm">Confirm</button>
          <button class="popup-cancel">Cancel</button>
        </section>
      </section>
    `;
                document.body.appendChild(overlay);

                overlay.querySelector(".popup-cancel")?.addEventListener("click", () => overlay.remove());
                overlay.querySelector(".popup-confirm")?.addEventListener("click", () => {
                    onConfirm();
                    overlay.remove();
                });
            }

            // ===== Show Toast =====
            function showToast(text, color = "blue") {
                const toast = document.createElement("section");
                toast.className = `popup-toast toast-${color}`;
                toast.textContent = text;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        });

    </script>


</body>

</html>